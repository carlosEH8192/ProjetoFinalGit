<!DOCTYPE html>
<html lang="pt-br">
<head>
    <title>Alcides Maya</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="<?= $paths->get_bootstrap_css(); ?>" />
    <link rel="stylesheet" href="<?= $paths->get_adjust(); ?>" />
    <link rel="stylesheet" href="<?= $paths->get_colors(); ?>" />
    <link rel="stylesheet" href="<?= $paths->get_icones(); ?>" />    
</head>
<body background="<?= $paths->get_background(); ?>">
    <?php include_once("../navbar_do_cabecalho_adm.php"); // Arquivo PHP isolado. ?>

    <div class="container-fluid">
        <h1 class="col-md-12">Consulta de Administradores</h1>
        <div class="col-md-12">
            <a class="btn btn-primary" href="insere_adm.php">Novo Administrador</a>
        </div>

        <div class="col-md-12">
            <input type="text" class="form-control" id="pesquisa" name="inp-pesquisa" placeholder="Filtro" onkeypress="filtra(event, this)" />
        </div>

        <div class="col-md-12">
            <table id="tabela" class="table table-hover">
                <thead>
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Username</th>
                        <th scope="col">Editar</th>
                        <th scope="col">Excluir</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>

    <script src="<?= $paths->get_jquery(); ?>"></script>
    <script src="<?= $paths->get_bootstrap_js(); ?>"></script>
    <script>
        var formatoTr = 
            '<tr>' +
                '<th scope="row">@cod</th>' +
                '<td>@username</td>' +
                '<td><a href="atualiza_adm.php?codigo=@cod" class="btn btn-default">Editar</a></td>' +
                '<td><button class="btn btn-danger" onclick="deletaAdm(@cod)">Excluir</button></td>' +
            '</tr>';

        function filtra(ev, input) {
            if(ev.which == 13)
                buscaAdms(input.value);
        }

        function buscaAdms(filtro) {
            $.get('_busca_adms.php', { filtro: filtro }, function(adms) {
                montaTabela(JSON.parse(adms));
            });
        }

        function montaTabela(json) {
            var tr = null;
            var $tbody = $('#tabela tbody');
            $tbody.empty();

            for (var i = 0; i < json.length; i++) {
                tr += formatoTr.replace(/@cod/g, json[i].codigo)
                    .replace('@username', json[i].username)
            }

            $tbody.html(tr);
        }

        function deletaAdm(codigo) {
            $.post("_deleta_adm.php", { codigo: codigo }, function() {
                buscaAdms($("#pesquisa").val());
            });
        }

        $(function() { buscaAdms(null); });
    </script>
</body>
</html>